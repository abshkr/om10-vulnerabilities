<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" height="450" width="410"
		 skinClass="skins.WidgetPanelSkin" title="Folio Reports" backgroundAlpha="1.0" xmlns:components="components.*">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			
			[Bindable] public var reports:ArrayCollection;
			public var callback:Function;
			private var reportList:Object=new Object();
			
			protected function generateHandler(event:MouseEvent):void
			{
				dispatchEvent(new CloseEvent(CloseEvent.CLOSE,true, false));
				callback(reportList);
			}
			
			protected function downloadHandler(event:MouseEvent):void
			{
				dispatchEvent(new CloseEvent(CloseEvent.CLOSE,true, false));
			}
			
			protected function viewHandler(event:MouseEvent):void
			{
				if (lst.selectedIndex  > -1)
				{
					trace("here", reports[lst.selectedIndex].payload.location);
					var paths:Array =  reports[lst.selectedIndex].payload.location.split("/");
					var path:String = paths.pop();
					path = paths.pop()+"/"+path;
					navigateToURL(new URLRequest(global.reportsGateway+"?report="+path),'_blank')
					//navigateToURL(new URLRequest("/folio_rpts/OM02/54/ANY_Tank_Summary_Daily.csv"),'_blank')
				}
			}
			
			protected function closeHandler(event:MouseEvent):void
			{
				PopUpManager.removePopUp(this);				
			}
			
			protected function getLabel(item:Object):String
			{
				return item.payload.name;
			}
			
			protected function list1_clickHandler(event:MouseEvent):void
			{
				//if (lst.selectedIndex > -1)
				//{
				//	navigateToURL(new URLRequest(reports[lst.selectedIndex].payload.location),'_blank')
				//}
			}
			
		]]>
	</fx:Script>
	<s:VGroup paddingTop="5" paddingLeft="5" paddingBottom="5" paddingRight="5" width="100%" height="100%">
		<s:Label text="Folio Reports" fontSize="14" fontWeight="bold" width="100%" textAlign="center"/>
		<mx:HRule width="100%"/>
		<s:List id="lst" dataProvider="{reports}" labelField="payload.name" width="100%" height="100%" labelFunction="{getLabel}"
				contentBackgroundAlpha="0" borderVisible="false" useVirtualLayout="false" click="list1_clickHandler(event)">
		</s:List>
		<s:HGroup width="100%">
			<s:Spacer width="100%"/>
			<components:DKI_Button id="btn_generate" label="Regenerate" type="report" click="generateHandler(event)"/>		
			<components:DKI_Button id="btn_view" label="View Selected" type="report" enabled="{lst.selectedIndex != -1}" click="viewHandler(event)"/>
			<components:DKI_Button id="btn_cancel" label="Close" type="close" click="closeHandler(event)" />		
		</s:HGroup>	
	</s:VGroup>
	
</s:Panel>
